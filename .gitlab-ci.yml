image : node:latest

stages:
  - install
  - test

cache :
  paths :
   - node_modules/

install :
 stage : install
 cache: 
    key: $CI_COMMIT_REF_SLUG-$CI_PROJECT_DIR
    paths:
      - node_modules/
 script:
  - npm install
 only:
  changes:
    - package-lock.json

test :
  stage : test
  script : 
   - npm run test

production:
  stage: deploy
  image: ruby:latest
  script:
    - apt-get update -qy
    - apt-get install -y ruby-dev
    - gem install dpl
    - dpl --provider=heroku --app=budev --api-key=d2da7495-2783-4633-ba2e-817d155d2dee
  only:
    - ci
